<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Tracing Java Applications | Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.snappyflow.io//docs/Tracing/java_v2"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Tracing Java Applications | Documentation"><meta data-react-helmet="true" name="description" content="sfTrace Java Agent automatically instruments various APIs, frameworks and application servers. Currently sfTrace supports the following:"><meta data-react-helmet="true" property="og:description" content="sfTrace Java Agent automatically instruments various APIs, frameworks and application servers. Currently sfTrace supports the following:"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.snappyflow.io//docs/Tracing/java_v2"><link data-react-helmet="true" rel="alternate" href="https://docs.snappyflow.io//docs/Tracing/java_v2" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.snappyflow.io//docs/Tracing/java_v2" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.52354062.css">
<link rel="preload" href="/assets/js/runtime~main.7f578231.js" as="script">
<link rel="preload" href="/assets/js/main.63bb1200.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.snappyflow.io/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/logo-new.png" alt="SnappyFlow" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-new.png" alt="SnappyFlow" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link" target="_self" href="/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tracing Java Applications</h1></header><p>sfTrace Java Agent automatically instruments various APIs, frameworks and application servers. Currently sfTrace supports the following:  </p><div class="blue_textbox"><b>Supported Java versions</b><p>Oracle JDK: 7u60+, 8u40+, 9, 10, 11 <br>Open JDK: 7u60+, 8u40+, 9, 10, 11 </p><b>Supported Web Frameworks</b><p>Spring Web MVC 4.x, 5.x <br>Spring Boot 1.5+, 2.x supports embedded Tomcat <br>JAX-RS 2.x  <br>JAX-WS  <br></p><b>Supported Application Servers</b><p>Tomcat 7.x, 8.5.x, 9.x <br>Wildfly 8-16 <br>JBoss EAP 6.4, 7.0, 7.1, 7.2</p></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="available-platforms"></a>Available Platforms<a class="hash-link" href="#available-platforms" title="Direct link to heading">#</a></h2><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs tabs_main"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active"><img class="tab_header_image" src="/img/platform-instance.svg"><span class="tab_header_label">Instance</span></li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI"><img class="tab_header_image" src="/img/platform-kubernetes.svg"><span class="tab_header_label">Kubernetes</span></li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI"><img class="tab_header_image" src="/img/platform-docker.svg"><span class="tab_header_label">Docker</span></li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI"><img class="tab_header_image" src="/img/platform-ecs.svg"><span class="tab_header_label">ECS</span></li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI"><img class="tab_header_image" src="/img/platform-aws-lambda.svg"><span class="tab_header_label">AWS Lambda</span></li></ul><div class="margin-vert--md"><div role="tabpanel"><p>Tracing JAVA applications on instances is a 2 step process involving installation of SnappyFlow agent on the instance and configuring the app to allow metrics to be collected.</p><ol><li>Install agent</li><li>Configure application for tracing</li></ol><p>Configuring the app allows the collection of metrics by the SnappyFlow trace agent. There are multiple ways to configure JAVA apps depending on the type of JAVA application. Choose the type below or follow the command line instructions for generic JAVA applications. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="command-line"></a>Command Line<a class="hash-link" href="#command-line" title="Direct link to heading">#</a></h3><p>Use the following arguments while starting your application using java –jar command, in IDE, Maven or Gradle script: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">java -javaagent:/opt/sfagent/sftrace/java/sftrace-java-agent.jar -Dsftrace.service_name=&lt;my-service&gt; -jar &lt;application jar&gt; </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note: If service_name is not provided, an auto discovered service name will be added. Service_name is used to identify and filter the traces related to an application and should be named appropriately to distinctly identify it. Service name must only contain characters from the ASCII alphabet, numbers, dashes, underscores and spaces.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="additional-features-available-for-spring-boot-applications"></a>Additional features available for Spring Boot Applications<a class="hash-link" href="#additional-features-available-for-spring-boot-applications" title="Direct link to heading">#</a></h5><p>By default, transaction names of unsupported Servlet API-based frameworks are in the form of $method unknown route. To modify this and to report the transactions names in the form of $method $path, use the following in javaagent configuration. This option is applicable only for spring-boot based applications.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.disable_instrumentations=spring-mvc  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.use_path_as_transaction_name=true </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="normalizing-transaction-urls"></a>Normalizing Transaction URLs<a class="hash-link" href="#normalizing-transaction-urls" title="Direct link to heading">#</a></h6><p>If your URLs contain path parameters like /user/$userId, it can lead to an explosion of transaction types. This can be avoided by using URL groups.
For example, if the application supports urls like: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/owners, /owners/&lt;owner_id&gt;, /owners/&lt;owner_id&gt;/edit, /owners/&lt;owner_id&gt;/pets, </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>then url groups would be configured as: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">url_groups=/owners/*,/owner/*/edit,/owners/*/pets </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="apache-tomcat"></a>Apache Tomcat<a class="hash-link" href="#apache-tomcat" title="Direct link to heading">#</a></h3><p>Add the agent configuration in setenv.sh. If this file is not present,  create the file in below folder</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;tomcat installation path&gt;/bin</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/tomcat_setenv.sh" target="_blank" rel="noopener noreferrer">tomcat_setenv.sh</a>  for tracing specific configuration that needs to be copied to setenv.sh file.
Make the file executable using chmod +x bin/setenv.sh and start the server</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="additional-features-available-for-spring-boot-applications-1"></a>Additional features available for Spring Boot Applications<a class="hash-link" href="#additional-features-available-for-spring-boot-applications-1" title="Direct link to heading">#</a></h5><p>By default, transaction names of unsupported Servlet API-based frameworks are in the form of $method unknown route. To modify this and to report the transactions names in the form of $method $path, use the following in javaagent configuration. This option is applicable only for spring-boot based applications.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.disable_instrumentations=spring-mvc  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.use_path_as_transaction_name=true </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="normalizing-transaction-urls-1"></a>Normalizing Transaction URLs<a class="hash-link" href="#normalizing-transaction-urls-1" title="Direct link to heading">#</a></h6><p>If your URLs contain path parameters like /user/$userId, it can lead to an explosion of transaction types. This can be avoided by using URL groups.
For example, if the application supports urls like: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/owners, /owners/&lt;owner_id&gt;, /owners/&lt;owner_id&gt;/edit, /owners/&lt;owner_id&gt;/pets, </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>then url groups would be configured as: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">url_groups=/owners/*,/owner/*/edit,/owners/*/pets </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h6></h6><p>Add the agent configuration in setenv.sh. If this file is not present,  create the file in below folder</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;tomcat installation path&gt;/bin</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/tomcat_setenv.sh" target="_blank" rel="noopener noreferrer">tomcat_setenv.sh</a>  for tracing specific configuration that needs to be copied to setenv.sh file.
Make the file executable using chmod +x bin/setenv.sh and start the server</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="jbosseap"></a>JBOSS/EAP<a class="hash-link" href="#jbosseap" title="Direct link to heading">#</a></h3><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="standalone-mode"></a>Standalone Mode<a class="hash-link" href="#standalone-mode" title="Direct link to heading">#</a></h6><p>Add the agent configuration in standalone.conf file and start the server
Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/JBOSS_standalone.conf" target="_blank" rel="noopener noreferrer">JBOSS_standalone.conf</a> for tracing specific configuration. Copy from section with “SFTRACE-CONFIG” in comments </p><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="domain-mode"></a>Domain Mode<a class="hash-link" href="#domain-mode" title="Direct link to heading">#</a></h6><p>Add the agent configuration in domain.xml and start the server
Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/JBOSS_domain.xml" target="_blank" rel="noopener noreferrer">JBOSS_domain.xml</a>  for tracing specific configuration. Copy from section with “SFTRACE-CONFIG” in comments
After updating the configuration, restart the application. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="additional-features-available-for-spring-boot-applications-2"></a>Additional features available for Spring Boot Applications<a class="hash-link" href="#additional-features-available-for-spring-boot-applications-2" title="Direct link to heading">#</a></h5><p>By default, transaction names of unsupported Servlet API-based frameworks are in the form of $method unknown route. To modify this and to report the transactions names in the form of $method $path, use the following in javaagent configuration. This option is applicable only for spring-boot based applications.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.disable_instrumentations=spring-mvc  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.use_path_as_transaction_name=true </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="normalizing-transaction-urls-2"></a>Normalizing Transaction URLs<a class="hash-link" href="#normalizing-transaction-urls-2" title="Direct link to heading">#</a></h6><p>If your URLs contain path parameters like /user/$userId, it can lead to an explosion of transaction types. This can be avoided by using URL groups.
For example, if the application supports urls like: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/owners, /owners/&lt;owner_id&gt;, /owners/&lt;owner_id&gt;/edit, /owners/&lt;owner_id&gt;/pets, </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>then url groups would be configured as: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">url_groups=/owners/*,/owner/*/edit,/owners/*/pets </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="example-of-running-java-application-via-command-line-using-these-parameters"></a>Example of running java application via command line using these parameters<a class="hash-link" href="#example-of-running-java-application-via-command-line-using-these-parameters" title="Direct link to heading">#</a></h6><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">java -javaagent:/opt/sfagent/sftrace/java/sftrace-java-agent.jar </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Dsftrace.service_name=my-service </span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.disable_instrumentations=spring-mvc </span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.use_path_as_transaction_name=true </span></span><span class="token-line" style="color:#393A34"><span class="token plain">-Delastic.apm.url_groups=/owners/*,/owner/*/edit,/owners/*/pets -jar &lt;application jar&gt; </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><ul><li><p>Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/java_Dockerfile" target="_blank" rel="noopener noreferrer">java_Dockerfile</a>. </p></li><li><p>Look at sections with SFTRACE-CONFIG description. </p></li><li><p>Installation steps are provided. </p></li><li><p>copy the trace agent to the container and start the container by attaching the agent to the application. </p></li><li><p>Additionally, user has to add SnappyFlow configurations for profile_key, projectName, appName to the docker file </p></li><li><p>Once updated, build and start the container.</p></li></ul></div><div role="tabpanel" hidden="">coming soon ! coming soon !<p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p><p>coming soon !</p></div><div role="tabpanel" hidden=""><p>sfTrace is run as an initContainer in the application pod. User can deploy this either using a manifest yaml or a Helm chart.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-of-manifest-yaml"></a>Example of Manifest yaml<a class="hash-link" href="#example-of-manifest-yaml" title="Direct link to heading">#</a></h5><p><a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/java_k8s_standalone_deployment.yaml" target="_blank" rel="noopener noreferrer">java_k8s_standalone_deployment.yaml</a>  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-of-a-helm-chart"></a>Example of a Helm chart<a class="hash-link" href="#example-of-a-helm-chart" title="Direct link to heading">#</a></h5><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="update-valuesyaml"></a>Update values.yaml<a class="hash-link" href="#update-valuesyaml" title="Direct link to heading">#</a></h6><p>Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/java_k8s_with_helm_chart_values.yaml" target="_blank" rel="noopener noreferrer">java_k8s_with_helm_chart_values.yaml</a>  to configure agent specific properties. Look at sections with SFTRACE-CONFIG description </p><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="update-deploymentyaml"></a>Update deployment.yaml<a class="hash-link" href="#update-deploymentyaml" title="Direct link to heading">#</a></h6><p>Refer to <a href="https://github.com/snappyflow/website-artefacts/blob/master/sfTracing/java/java_k8s_with_helm_chart_deployment.yaml" target="_blank" rel="noopener noreferrer">java_k8s_with_helm_chart_deployment.yaml</a>  to copy trace agent to the container and start the container by attaching  the agent. Look at sections with SFTRACE-CONFIG description</p></div><div role="tabpanel" hidden=""><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="create-the-task-definition"></a>Create the Task definition<a class="hash-link" href="#create-the-task-definition" title="Direct link to heading">#</a></h5><ul><li><p>Open Amazon ECS, in navigation pane, choose task definition and click on Create New Task Definition and select the launch type as EC2 or  Fargate, click on Next step. </p></li><li><p>Give the Task definition Name </p></li><li><p>Task Role, choose an IAM role that provides permissions for containers in  your task to make calls to AWS APIs on your behalf and Network Mode</p></li><li><p>Click on Add containers. Give a Container name, and give the Image of your Java Application. Set Memory limit and port mappings as per your task requirements. In the environment section, for Entry Point give sh , -c For Command paste the following lines </p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /sfagent &amp;&amp; wget -O /sfagent/sftrace-agent.tar.gz</span></span><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/snappyflow/apm-agent/releases/download/latest/sftrace-agent.tar.gz &amp;&amp; cd /sfagent &amp;&amp; tar -xvzf sftrace-agent.tar.gz &amp;&amp; java -javaagent:/sfagent/sftrace/java/sftrace-java-agent.jar -jar &lt;your_jar_name&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Note:</strong>
Some EC2 task definitions may be running on host containers that don’t recoginise the wget command in such case, add below lines in the above  command, apt update &amp;&amp; apt -y upgrade.
Add the following Environment Variables:-</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">SFTRACE_PROJECT_NAME &lt;project_name&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">SFTRACE_APP_NAME &lt;app_name&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">SFTRACE_SERVICE_NAME &lt;service_name&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">SFTRACE_PROFILE_KEY &lt;profile_key&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The below environment variables are only applicable for springmvc and optional.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ELASTIC_APM_DISABLE_INSTRUMENTATIONS spring-mvc</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ELASTIC_APM_USE_PATH_AS_TRANSACTION_NAME &quot;true&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="create-the-cluster"></a>Create the Cluster<a class="hash-link" href="#create-the-cluster" title="Direct link to heading">#</a></h5><ul><li>In the Navigation pane, select Clusters and click on Create Cluster</li><li>Select the template as per your requirement</li><li>Give a Cluster name and give instance, networking Configurations IAM role as per your task requirements</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="create-the-service"></a>Create the Service<a class="hash-link" href="#create-the-service" title="Direct link to heading">#</a></h5><ul><li>Click on the Cluster Name you created in the step2</li><li>Click on Create , Select the Launch type matching to your task definition.  Select the Task Definition Name and Version in the Drop down matching to the task definition you created in step 1</li><li>Give a Service Name and select other requirements as per your task compatibility</li><li>Click on next step and start your service</li></ul></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ram-dot-kumar/SFwebsite.git/docs/Tracing/java_v2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#available-platforms" class="table-of-contents__link">Available Platforms</a><ul><li><a href="#command-line" class="table-of-contents__link">Command Line</a></li><li><a href="#apache-tomcat" class="table-of-contents__link">Apache Tomcat</a></li><li><a href="#jbosseap" class="table-of-contents__link">JBOSS/EAP</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7f578231.js"></script>
<script src="/assets/js/main.63bb1200.js"></script>
</body>
</html>